<!DOCTYPE html>
<html>
<head>
    <title>CloudFlare Latency Test</title>
</head>
<body>
    <h1>Edge Latency Tester</h1>
    <button id="testBtn">Run Test</button>
    <pre id="output"></pre>

    <script>
        async function measureEdgeLatency() {
            let iterations = 5;
            let avg_rtt = 0;
            let data = null;
            let min_rtt = Infinity;
            let max_rtt = -Infinity;

            document.getElementById("output").textContent = "";

            for (let i = 0; i < iterations; i++) {
                let start = performance.now();
                let res = await fetch("/ping");
                let end = performance.now();
                
                data = await res.json();
                let rtt = end - start;

                avg_rtt = avg_rtt + (rtt - avg_rtt) / (i + 1);
                min_rtt = Math.min(rtt, min_rtt);
                max_rtt = Math.max(rtt, max_rtt);

                document.getElementById("output").textContent += `Ping ${i+1}: ${rtt.toFixed(2)} ms\n`;
            }
            let jitter = max_rtt - min_rtt;

            document.getElementById("output").textContent +=
                `Average RTT: ${avg_rtt.toFixed(2)} ms\n` +
                `Jitter: ${jitter.toFixed(2)} ms\n` + 
                `ASN: ${data.asn}\n` +
                `Country: ${data.country}\n` +
                `City: ${data.city}\n` +
                `PoP: ${data.colo}`;
        }

        document.getElementById("testBtn").addEventListener("click", measureEdgeLatency);
    </script>
</body>



</html>